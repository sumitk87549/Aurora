<div class="admin-dashboard">
  <header class="admin-header">
    <h1>Admin Dashboard</h1>
    <button class="logout-btn" (click)="logout()">Logout</button>
  </header>

  <div class="admin-content">
    <div class="candle-management">
      <h2>Candle Management</h2>

      <!-- Add New Candle Form -->
      <div class="add-candle-form">
        <h3>Add New Candle</h3>
        <form (ngSubmit)="createCandle()">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Name</label>
              <input type="text" id="name" name="name" [(ngModel)]="newCandle.name" required />
            </div>
            <div class="form-group">
              <label for="price">Price</label>
              <input type="number" id="price" name="price" [(ngModel)]="newCandle.price" required min="0" />
            </div>
          </div>
          <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" [(ngModel)]="newCandle.description" required rows="3"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="stockQuantity">Stock Quantity</label>
              <input type="number" id="stockQuantity" name="stockQuantity" [(ngModel)]="newCandle.stockQuantity" required min="0" />
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" name="available" [(ngModel)]="newCandle.available" />
                Available
              </label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>
                <input type="checkbox" name="creatorsChoice" [(ngModel)]="newCandle.creatorsChoice" (change)="onCreatorsChoiceChange()" />
                Creator's Choice
              </label>
            </div>
            <div class="form-group" *ngIf="newCandle.creatorsChoice">
              <label for="creatorsText">Creator's Text</label>
              <input type="text" id="creatorsText" name="creatorsText" [(ngModel)]="newCandle.creatorsText" />
            </div>
          </div>
          <div class="form-group">
            <label for="images">Product Images</label>
            <input type="file" id="images" name="images" multiple accept=".jpg,.jpeg,.png,.gif" (change)="onImageSelect($event)" />
            <div *ngIf="selectedImages.length > 0" class="selected-images">
              <p>Selected images:</p>
              <ul>
                <li *ngFor="let image of selectedImages">{{ image.name }}</li>
              </ul>
            </div>
          </div>
          <button type="submit" class="btn btn-primary" [disabled]="isCreating">
            {{ isCreating ? 'Creating...' : 'Add Candle' }}
          </button>
        </form>
      </div>

      <!-- Edit Candle Form -->
      <div class="edit-candle-form" *ngIf="isEditing && editingCandle">
        <h3>Edit Candle</h3>
        <form (ngSubmit)="updateCandle()">
          <div class="form-row">
            <div class="form-group">
              <label for="editName">Name</label>
              <input type="text" id="editName" name="editName" [(ngModel)]="editingCandle.name" required />
            </div>
            <div class="form-group">
              <label for="editPrice">Price</label>
              <input type="number" id="editPrice" name="editPrice" [(ngModel)]="editingCandle.price" required min="0" />
            </div>
          </div>
          <div class="form-group">
            <label for="editDescription">Description</label>
            <textarea id="editDescription" name="editDescription" [(ngModel)]="editingCandle.description" required rows="3"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="editStockQuantity">Stock Quantity</label>
              <input type="number" id="editStockQuantity" name="editStockQuantity" [(ngModel)]="editingCandle.stockQuantity" required min="0" />
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" name="editAvailable" [(ngModel)]="editingCandle.available" />
                Available
              </label>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>
                <input type="checkbox" name="editCreatorsChoice" [(ngModel)]="editingCandle.creatorsChoice" (change)="onCreatorsChoiceChange()" />
                Creator's Choice
              </label>
            </div>
            <div class="form-group" *ngIf="editingCandle.creatorsChoice">
              <label for="editCreatorsText">Creator's Text</label>
              <input type="text" id="editCreatorsText" name="editCreatorsText" [(ngModel)]="editingCandle.creatorsText" />
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Update Candle</button>
            <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
          </div>
        </form>
      </div>

      <!-- Candles List -->
      <div class="candles-list">
        <h3>Existing Candles</h3>
        <div class="loading-spinner" *ngIf="isLoading">
          <p>Loading candles...</p>
        </div>

        <div class="error-message" *ngIf="errorMessage">
          {{ errorMessage }}
        </div>

        <div class="candles-grid" *ngIf="!isLoading && !errorMessage">
          <div class="candle-card" *ngFor="let candle of candles">
            <div class="candle-image">
              <img [src]="getImageUrl(candle.images?.[0])" 
                   [alt]="candle.name" 
                   (error)="onImageError($event)" />
            </div>
            <div class="candle-info">
              <h4>{{ candle.name }}</h4>
              <p>{{ candle.description }}</p>
              <div class="candle-details">
                <span class="price">â‚¹{{ candle.price }}</span>
                <span class="stock">Stock: {{ candle.stockQuantity }}</span>
                <span class="status" [class.available]="candle.available" [class.unavailable]="!candle.available">
                  {{ candle.available ? 'Available' : 'Unavailable' }}
                </span>
              </div>
            </div>
            <div class="candle-actions">
              <button class="btn btn-secondary" (click)="editCandle(candle)">Edit</button>
              <button class="btn btn-danger" (click)="deleteCandle(candle.id)">Delete</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
